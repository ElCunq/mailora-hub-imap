<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mailora - UI Preview</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="premium.css">
</head>

<body>
    <!-- Mobile Overlay -->
    <div class="sidebar-overlay" id="sidebar-overlay" onclick="toggleMobileMenu()"></div>

    <!-- Compose Modal -->
    <div id="compose-modal" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>âœï¸ Yeni E-posta</h3>
                <button class="modal-close" onclick="closeCompose()">âœ•</button>
            </div>
            <div class="modal-body">
                <input type="text" id="compose-to" class="compose-input" placeholder="Kime">
                <input type="text" id="compose-subject" class="compose-input" placeholder="Konu">
                <textarea id="compose-body" class="compose-textarea" placeholder="MesajÄ±nÄ±z..."></textarea>

                <!-- File Attachment Section -->
                <div class="attachment-section" id="attachment-section">
                    <input type="file" id="compose-files" multiple accept="*/*" style="display:none;"
                        onchange="handleFileSelect(event)">
                    <div class="attachment-dropzone" id="dropzone"
                        onclick="document.getElementById('compose-files').click()">
                        <div class="dropzone-content">
                            <span class="dropzone-icon">ğŸ“</span>
                            <span class="dropzone-text">Dosya eklemek iÃ§in tÄ±klayÄ±n veya sÃ¼rÃ¼kleyin</span>
                            <span class="dropzone-hint">Maksimum 10MB â€¢ Resim, PDF, Belge</span>
                        </div>
                    </div>
                    <div id="attachment-preview" class="attachment-preview-list"></div>
                </div>

                <div class="schedule-row">
                    <label class="focus-toggle"><input type="checkbox" id="schedule-check"> ğŸ“… Zamanla</label>
                    <input type="datetime-local" id="schedule-time" class="schedule-input" style="display:none;">
                </div>
            </div>
            <div class="modal-footer">
                <button class="toolbar-btn" onclick="closeCompose()">Ä°ptal</button>
                <button class="send-btn" onclick="sendEmail()">ğŸ“¤ GÃ¶nder</button>
            </div>
        </div>
    </div>

    <!-- Analytics Drawer -->
    <div id="analytics-drawer" class="analytics-drawer">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h3 style="margin:0;">ğŸ“Š Analytics</h3>
            <button class="modal-close" onclick="toggleAnalytics()">âœ•</button>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="stat-total">156</div>
            <div class="stat-label">Toplam E-posta (Bu Ay)</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="stat-sent">42</div>
            <div class="stat-label">GÃ¶nderilen</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="stat-received">114</div>
            <div class="stat-label">AlÄ±nan</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="stat-response">~2.4 saat</div>
            <div class="stat-label">Ort. YanÄ±t SÃ¼resi</div>
        </div>
        <div class="stat-card">
            <div class="stat-label" style="margin-bottom:8px;">En Ã‡ok YazÄ±ÅŸÄ±lan</div>
            <div style="font-size:13px;">1. Mehmet Kaya (23)<br>2. AyÅŸe Åahin (18)<br>3. John Doe (12)</div>
        </div>
    </div>

    <!-- Contact Insights Drawer -->
    <div id="contact-drawer" class="contact-drawer">
        <div class="contact-header">
            <div class="contact-avatar" id="contact-avatar" style="background:var(--gradient-primary);">MK</div>
            <div>
                <div style="font-weight:600;" id="contact-name">Mehmet Kaya</div>
                <div style="font-size:12px; color:var(--text-muted);" id="contact-email">mehmet@firma.com</div>
            </div>
            <button class="modal-close" style="margin-left:auto;" onclick="closeContactDrawer()">âœ•</button>
        </div>
        <div class="contact-stats">
            <div class="contact-stat"><span>Toplam YazÄ±ÅŸma</span><span id="contact-total">23</span></div>
            <div class="contact-stat"><span>Ä°lk Ä°letiÅŸim</span><span id="contact-first">15 Ara 2024</span></div>
            <div class="contact-stat"><span>Son Ä°letiÅŸim</span><span id="contact-last">DÃ¼n</span></div>
            <div class="contact-stat"><span>Ort. YanÄ±t SÃ¼resi</span><span id="contact-response">~1.2 saat</span></div>
            <div class="contact-stat"><span>Ekli Dosya SayÄ±sÄ±</span><span id="contact-attachments">8</span></div>
        </div>
        <div style="padding:16px 20px;">
            <button class="toolbar-btn" style="width:100%;" onclick="showAttachmentGallery()">ğŸ“ TÃ¼m Ekler (8)</button>
        </div>
    </div>


    <div id="app">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">âœ‰</div>
                    <span>Mailora</span>
                </div>
                <div style="display:flex; gap:8px; align-items:center;">
                    <button class="theme-toggle" onclick="toggleTheme()" title="Tema DeÄŸiÅŸtir"
                        id="theme-btn">ğŸŒ™</button>
                    <div class="user-avatar">RU</div>
                </div>
            </div>

            <button class="compose-btn" onclick="openCompose()">
                <span>âœï¸</span> Yeni E-posta
            </button>

            <div class="section-title">Hesaplar</div>
            <div class="account-list" id="account-list"></div>

            <div class="section-title">KlasÃ¶rler</div>
            <div class="folder-list" id="folder-list"></div>

            <div style="margin-top:auto; padding:16px;">
                <label
                    style="display:flex; align-items:center; gap:8px; font-size:12px; color:var(--text-muted); cursor:pointer;">
                    <input type="checkbox" id="unified-check" onchange="toggleUnified()"
                        style="accent-color:var(--accent-blue);">
                    Unified Inbox
                </label>
            </div>
        </aside>

        <!-- Message List -->
        <section class="message-panel">
            <!-- Mobile Header -->
            <div class="mobile-header">
                <button class="mobile-menu-btn" onclick="toggleMobileMenu()">â˜°</button>
                <div class="logo">
                    <div class="logo-icon">âœ‰</div>
                    <span>Mailora</span>
                </div>
                <button class="theme-toggle" onclick="toggleTheme()" title="Tema DeÄŸiÅŸtir"
                    id="theme-btn-mobile">ğŸŒ™</button>
            </div>

            <div class="panel-header">
                <div class="search-box">
                    <input type="text" id="search-input" placeholder="E-postalarda ara..." oninput="searchMessages()">
                </div>
                <button class="toolbar-btn primary" onclick="syncMessages()"><span>ğŸ”„</span> Sync</button>
                <button class="toolbar-btn" onclick="refreshMessages()">â†»</button>
                <button class="toolbar-btn" onclick="toggleAnalytics()" title="Analytics">ğŸ“Š</button>
                <label class="focus-toggle" title="Focus Mode"><input type="checkbox" id="focus-check"
                        onchange="toggleFocusMode()"> ğŸ¯</label>
            </div>

            <div id="message-list"></div>
        </section>

        <!-- Preview Panel -->
        <section class="preview-panel">
            <div id="preview">
                <div class="empty-state">
                    <div class="empty-icon">ğŸ“¬</div>
                    <div class="empty-text">Bir e-posta seÃ§in</div>
                </div>
            </div>
        </section>
    </div>

    <style>
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal-content {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            width: 90%;
            max-width: 500px;
            box-shadow: var(--shadow-card);
        }

        .modal-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 16px;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 18px;
            cursor: pointer;
        }

        .modal-body {
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .modal-footer {
            padding: 16px 20px;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .preview-body p {
            margin: 12px 0;
        }

        .preview-body ul li {
            margin: 8px 0;
        }

        /* Toast notification */
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: var(--accent-green);
            color: white;
            padding: 12px 20px;
            border-radius: var(--radius-sm);
            font-size: 14px;
            z-index: 3000;
            animation: slideIn 0.3s ease-out;
        }

        .toast.undo {
            background: var(--accent-orange);
        }

        @keyframes slideIn {
            from {
                transform: translateY(20px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Pin Badge */
        .pin-badge {
            color: var(--accent-orange);
            margin-right: 4px;
        }

        /* Quick Actions on Hover */
        .msg-actions {
            display: none;
            gap: 4px;
            margin-left: auto;
        }

        .message-row:hover .msg-actions {
            display: flex;
        }

        .msg-action-btn {
            width: 28px;
            height: 28px;
            border: none;
            background: var(--bg-tertiary);
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .msg-action-btn:hover {
            background: var(--accent-blue);
            color: white;
        }

        /* Reading Time */
        .reading-time {
            font-size: 10px;
            color: var(--text-muted);
            background: var(--bg-tertiary);
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 8px;
        }

        /* AI Summary Badge */
        .ai-summary {
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
            color: white;
            font-size: 10px;
            padding: 4px 8px;
            border-radius: 6px;
            margin-bottom: 12px;
        }

        /* Translate Button */
        .translate-btn {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .translate-btn:hover {
            border-color: var(--accent-blue);
            color: var(--accent-blue);
        }

        .translate-select {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            padding: 4px 8px;
            border-radius: 4px;
            color: var(--text-primary);
            font-size: 11px;
        }

        /* Quick Reply Buttons */
        .quick-replies {
            display: flex;
            gap: 8px;
            padding: 12px 24px;
            border-top: 1px solid var(--border);
            flex-wrap: wrap;
        }

        .quick-reply-btn {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            padding: 8px 14px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: var(--transition);
        }

        .quick-reply-btn:hover {
            background: var(--accent-blue);
            color: white;
            border-color: var(--accent-blue);
        }

        /* Snooze Dropdown */
        .snooze-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 8px 0;
            min-width: 180px;
            z-index: 100;
            box-shadow: var(--shadow-card);
            display: none;
        }

        .snooze-menu.open {
            display: block;
        }

        .snooze-option {
            padding: 8px 16px;
            font-size: 13px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
        }

        .snooze-option:hover {
            background: var(--hover-bg);
            color: var(--text-primary);
        }

        /* Focus Mode */
        .focus-mode .message-row:not(.important) {
            opacity: 0.4;
            filter: blur(1px);
        }

        .focus-toggle {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
            color: var(--text-muted);
            cursor: pointer;
        }

        .focus-toggle input {
            accent-color: var(--accent-purple);
        }

        /* Analytics Drawer */
        .analytics-drawer {
            position: fixed;
            right: 0;
            top: 0;
            width: 320px;
            height: 100vh;
            background: var(--bg-secondary);
            border-left: 1px solid var(--border);
            z-index: 2000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            padding: 20px;
            overflow-y: auto;
        }

        .analytics-drawer.open {
            transform: translateX(0);
        }

        .stat-card {
            background: var(--bg-tertiary);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        /* Contact Insights */
        .contact-drawer {
            position: fixed;
            right: 0;
            top: 0;
            width: 350px;
            height: 100vh;
            background: var(--bg-secondary);
            border-left: 1px solid var(--border);
            z-index: 2000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .contact-drawer.open {
            transform: translateX(0);
        }

        .contact-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .contact-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 18px;
        }

        .contact-stats {
            padding: 16px 20px;
        }

        .contact-stat {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
            font-size: 13px;
        }

        /* Unsubscribe Banner */
        .unsubscribe-banner {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.2);
            padding: 10px 16px;
            margin: 0 24px 12px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 12px;
        }

        .unsubscribe-btn {
            background: var(--accent-red);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 11px;
        }

        /* Read Receipt */
        .read-receipt {
            font-size: 11px;
            color: var(--accent-green);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* Undo Toast */
        .undo-btn {
            background: white;
            color: var(--accent-orange);
            border: none;
            padding: 4px 10px;
            border-radius: 4px;
            margin-left: 12px;
            cursor: pointer;
            font-weight: 600;
        }

        /* Schedule Modal */
        .schedule-row {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .schedule-input {
            flex: 1;
            padding: 10px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
        }

        /* File Attachment Styles */
        .attachment-section {
            margin-top: 12px;
        }

        .attachment-dropzone {
            border: 2px dashed var(--border);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--bg-tertiary);
        }

        .attachment-dropzone:hover,
        .attachment-dropzone.dragover {
            border-color: var(--accent-blue);
            background: rgba(59, 130, 246, 0.1);
        }

        .dropzone-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .dropzone-icon {
            font-size: 28px;
            opacity: 0.8;
        }

        .dropzone-text {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .dropzone-hint {
            font-size: 11px;
            color: var(--text-muted);
        }

        .attachment-preview-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .attachment-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 12px;
            animation: slideIn 0.2s ease-out;
        }

        .attachment-item.image {
            flex-direction: column;
            padding: 8px;
        }

        .attachment-item .preview-img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 6px;
        }

        .attachment-item .file-icon {
            font-size: 18px;
        }

        .attachment-item .file-info {
            display: flex;
            flex-direction: column;
        }

        .attachment-item .file-name {
            color: var(--text-primary);
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .attachment-item .file-size {
            color: var(--text-muted);
            font-size: 10px;
        }

        .attachment-item .remove-btn {
            background: none;
            border: none;
            color: var(--accent-red);
            cursor: pointer;
            font-size: 14px;
            padding: 4px;
            border-radius: 4px;
            transition: var(--transition);
        }

        .attachment-item .remove-btn:hover {
            background: rgba(239, 68, 68, 0.2);
        }

        .attachment-error {
            color: var(--accent-red);
            font-size: 11px;
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
    </style>

    <script>
        // ===== DEMO DATA =====
        const accounts = [
            { id: 'gmail', name: 'Gmail KiÅŸisel', email: 'kullanici@gmail.com', type: 'gmail', icon: 'ğŸ“§' },
            { id: 'outlook', name: 'Ä°ÅŸ HesabÄ±', email: 'is@outlook.com', type: 'outlook', icon: 'ğŸ“¨' },
            { id: 'icloud', name: 'iCloud', email: 'user@icloud.com', type: 'icloud', icon: 'âœ‰ï¸' }
        ];

        const folders = [
            { id: 'inbox', name: 'Inbox', icon: 'ğŸ“¥', count: 24 },
            { id: 'sent', name: 'Sent', icon: 'ğŸ“¤', count: 0 },
            { id: 'drafts', name: 'Drafts', icon: 'ğŸ“', count: 3, color: 'var(--accent-orange)' },
            { id: 'spam', name: 'Spam', icon: 'âš ï¸', count: 12, color: 'var(--accent-red)' },
            { id: 'trash', name: 'Trash', icon: 'ğŸ—‘ï¸', count: 0 }
        ];

        const messages = [
            {
                id: 1, from: 'John Doe', email: 'john@example.com', subject: 'Proje GÃ¼ncellemesi: Q1 2026 Hedefleri', time: '10:30', unread: true, hasAttachment: true, account: 'gmail', folder: 'inbox',
                body: '<p>Merhaba,</p><p>Q1 2026 hedeflerimiz hakkÄ±nda gÃ¼ncelleme paylaÅŸmak istiyorum. Ekip olarak bÃ¼yÃ¼k ilerleme kaydettik.</p><p>Detaylar iÃ§in ekteki dosyaya bakabilirsin.</p><p>SaygÄ±lar,<br><strong>John</strong></p>',
                attachments: ['hedefler_2026.xlsx']
            },
            {
                id: 2, from: 'AyÅŸe Åahin', email: 'ayse@firma.com', subject: 'ToplantÄ± notlarÄ± ve aksiyon maddeleri', time: '09:15', unread: true, hasAttachment: false, account: 'outlook', folder: 'inbox',
                body: '<p>Merhaba,</p><p>DÃ¼nkÃ¼ toplantÄ±nÄ±n notlarÄ±nÄ± paylaÅŸÄ±yorum:</p><ul><li>Pazarlama stratejisi onaylandÄ±</li><li>Yeni Ã¼rÃ¼n lansmanÄ± Mart\'ta</li><li>BÃ¼tÃ§e revizyonu gerekli</li></ul><p>TeÅŸekkÃ¼rler,<br><strong>AyÅŸe</strong></p>'
            },
            {
                id: 3, from: 'Mehmet Kaya', email: 'mehmet.kaya@firma.com', subject: 'Re: HaftalÄ±k rapor teslimi', time: 'DÃ¼n', unread: false, hasAttachment: true, account: 'gmail', folder: 'inbox',
                body: '<p>Merhaba,</p><p>HaftalÄ±k raporu inceledim, genel olarak gÃ¼zel gÃ¶rÃ¼nÃ¼yor. BirkaÃ§ kÃ¼Ã§Ã¼k dÃ¼zeltme Ã¶nerim var:</p><ul><li>SatÄ±ÅŸ rakamlarÄ±nÄ± gÃ¼ncelleyebilir misin?</li><li>Grafiklerde Q4 karÅŸÄ±laÅŸtÄ±rmasÄ± eksik</li><li>SonuÃ§ bÃ¶lÃ¼mÃ¼ne 2026 hedeflerini ekleyelim</li></ul><p>YarÄ±n sabaha kadar gÃ¼ncellenmiÅŸ versiyonu gÃ¶nderebilir misin?</p><p>TeÅŸekkÃ¼rler,<br><strong>Mehmet</strong></p>',
                attachments: ['rapor_v2.xlsx', 'grafikler.png']
            },
            {
                id: 4, from: 'GitHub', email: 'noreply@github.com', subject: '[mailora-hub] Pull request #42 merged', time: 'DÃ¼n', unread: false, hasAttachment: false, account: 'gmail', folder: 'inbox',
                body: '<p>The following pull request has been merged:</p><p><strong>Fix IMAP connection timeout</strong></p><p>PR #42 by @developer</p><p>View on GitHub â†’</p>'
            },
            {
                id: 5, from: 'Zeynep YÄ±lmaz', email: 'zeynep@icloud.com', subject: 'Yeni yÄ±l kutlamasÄ± ve 2026 planlarÄ±', time: '2 Oca', unread: false, hasAttachment: true, account: 'icloud', folder: 'inbox',
                body: '<p>Herkese mutlu yÄ±llar! ğŸ‰</p><p>2026 iÃ§in harika planlarÄ±mÄ±z var. DetaylarÄ± Ã¶nÃ¼mÃ¼zdeki hafta paylaÅŸacaÄŸÄ±m.</p><p>Sevgiler,<br><strong>Zeynep</strong></p>',
                attachments: ['2026_planlar.pdf']
            },
            {
                id: 6, from: 'Amazon', email: 'shipment@amazon.com', subject: 'SipariÅŸiniz kargoya verildi', time: '1 Oca', unread: false, hasAttachment: false, account: 'gmail', folder: 'inbox',
                body: '<p>SipariÅŸiniz kargoya verildi!</p><p>Takip no: <strong>TR123456789</strong></p><p>Tahmini teslimat: 3-5 iÅŸ gÃ¼nÃ¼</p>'
            },
            {
                id: 7, from: 'Ben', email: 'kullanici@gmail.com', subject: 'Taslak: Proje Ã¶zeti', time: '3 Oca', unread: false, hasAttachment: false, account: 'gmail', folder: 'drafts',
                body: '<p>Bu bir taslak mesajdÄ±r...</p>'
            },
            {
                id: 8, from: 'Spam Bot', email: 'spam@fake.com', subject: 'KazandÄ±nÄ±z!!!', time: '1 Oca', unread: true, hasAttachment: false, account: 'gmail', folder: 'spam',
                body: '<p>Bu bir spam mesajÄ±dÄ±r.</p>'
            }
        ];

        // ===== STATE =====
        let currentAccount = 'gmail';
        let currentFolder = 'inbox';
        let selectedMessage = null;
        let filteredMessages = [];

        // ===== HELPERS =====
        const $ = id => document.getElementById(id);

        function getInitials(name) {
            const parts = name.trim().split(/[\s@]+/);
            if (parts.length >= 2) return (parts[0][0] + parts[1][0]).toUpperCase();
            return name.slice(0, 2).toUpperCase();
        }

        function getAvatarColor(str) {
            const colors = ['#3b82f6', '#8b5cf6', '#ec4899', '#10b981', '#f59e0b', '#ef4444', '#06b6d4'];
            let hash = 0;
            for (let i = 0; i < str.length; i++) hash = str.charCodeAt(i) + ((hash << 5) - hash);
            return colors[Math.abs(hash) % colors.length];
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        // ===== RENDER FUNCTIONS =====
        function renderAccounts() {
            const html = accounts.map(a => `
                <div class="account-item ${a.id === currentAccount ? 'active' : ''}" onclick="selectAccount('${a.id}')">
                    <div class="account-avatar ${a.type}">${a.icon}</div>
                    <div class="account-info">
                        <div class="account-name">${a.name}</div>
                        <div class="account-email">${a.email}</div>
                    </div>
                </div>
            `).join('');
            $('account-list').innerHTML = html;
        }

        function renderFolders() {
            const html = folders.map(f => {
                const count = messages.filter(m => m.folder === f.id && (currentAccount === 'all' || m.account === currentAccount)).length;
                const unreadCount = messages.filter(m => m.folder === f.id && m.unread && (currentAccount === 'all' || m.account === currentAccount)).length;
                const displayCount = f.id === 'inbox' ? unreadCount : (f.count || count);
                return `
                    <div class="folder-item ${f.id === currentFolder ? 'active' : ''}" onclick="selectFolder('${f.id}')">
                        <span class="folder-icon">${f.icon}</span>
                        <span>${f.name}</span>
                        ${displayCount > 0 ? `<span class="folder-count" style="background:${f.color || 'var(--accent-blue)'}">${displayCount}</span>` : ''}
                    </div>
                `;
            }).join('');
            $('folder-list').innerHTML = html;
        }

        function renderMessages() {
            const unified = $('unified-check')?.checked;
            filteredMessages = messages.filter(m => {
                if (m.folder !== currentFolder) return false;
                if (!unified && m.account !== currentAccount) return false;
                return true;
            });

            const searchTerm = $('search-input')?.value.toLowerCase() || '';
            if (searchTerm) {
                filteredMessages = filteredMessages.filter(m =>
                    m.from.toLowerCase().includes(searchTerm) ||
                    m.subject.toLowerCase().includes(searchTerm)
                );
            }

            if (filteredMessages.length === 0) {
                $('message-list').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“­</div>
                        <div class="empty-text">Bu klasÃ¶rde mesaj yok</div>
                    </div>`;
                return;
            }

            // Sort: pinned first
            filteredMessages.sort((a, b) => (b.pinned ? 1 : 0) - (a.pinned ? 1 : 0));

            const html = filteredMessages.map(m => {
                const initials = getInitials(m.from);
                const color = getAvatarColor(m.from);
                const acc = accounts.find(a => a.id === m.account);
                const readTime = getReadingTime(m.body);
                return `
                    <div class="message-row ${m.unread ? 'unread' : ''} ${selectedMessage === m.id ? 'selected' : ''} ${m.important ? 'important' : ''}" 
                         onclick="selectMessage(${m.id})">
                        ${m.pinned ? '<span class="pin-badge">ğŸ“Œ</span>' : ''}
                        ${m.unread && !m.pinned ? '<div class="unread-dot"></div>' : !m.pinned ? '<div style="width:8px;"></div>' : ''}
                        <div class="msg-avatar" style="background:${color}22; color:${color};" onclick="openContactInsights(messages.find(x=>x.id===${m.id}), event)">${initials}</div>
                        <div class="msg-content">
                            <div class="msg-header">
                                <span class="msg-from">${m.from}</span>
                                <span class="reading-time">~${readTime} dk</span>
                                <span class="msg-time">${m.time}</span>
                            </div>
                            <div class="msg-subject">${m.subject}</div>
                            <div class="msg-tags">
                                <span class="msg-tag" style="background:${color}22; color:${color};">${acc?.name || m.account}</span>
                                ${m.hasAttachment ? '<span class="msg-tag attachment">ğŸ“ Ek</span>' : ''}
                                ${m.isNewsletter ? '<span class="msg-tag" style="background:#ef444422; color:#ef4444;">ğŸ“° Newsletter</span>' : ''}
                            </div>
                        </div>
                        <div class="msg-actions">
                            <button class="msg-action-btn" onclick="togglePin(${m.id}, event)" title="${m.pinned ? 'Sabitlemeyi kaldÄ±r' : 'Sabitle'}">ğŸ“Œ</button>
                            <button class="msg-action-btn" onclick="snoozeMessage(${m.id}, '1 saat', event)" title="Ertele">â°</button>
                        </div>
                    </div>
                `;
            }).join('');

            $('message-list').innerHTML = html;
        }

        function renderPreview(msg) {
            const initials = getInitials(msg.from);
            const color = getAvatarColor(msg.from);
            const readTime = getReadingTime(msg.body);
            const summaryText = msg.body?.replace(/<[^>]*>/g, '').substring(0, 80) + '...';

            $('preview').innerHTML = `
                <div class="preview-header">
                    <div class="preview-subject">${msg.subject}</div>
                    <div class="preview-meta">
                        <div class="preview-avatar" style="background:${color};" onclick="openContactInsights(messages.find(x=>x.id===${msg.id}), event)">${initials}</div>
                        <div class="preview-sender">
                            <div class="preview-from">${msg.from}</div>
                            <div class="preview-date">${msg.email} â€¢ ${msg.time} â€¢ ~${readTime} dk okuma</div>
                        </div>
                        <div class="preview-actions">
                            <button class="action-btn" onclick="replyMessage(${msg.id})" title="YanÄ±tla">â†©ï¸</button>
                            <button class="action-btn" onclick="forwardMessage(${msg.id})" title="Ä°let">â†ªï¸</button>
                            <button class="action-btn" onclick="deleteMessage(${msg.id})" title="Sil">ğŸ—‘ï¸</button>
                            <button class="action-btn" onclick="togglePin(${msg.id})" title="Sabitle">ğŸ“Œ</button>
                        </div>
                    </div>
                    <div style="display:flex; gap:12px; margin-top:12px; align-items:center;">
                        <div class="ai-summary">ğŸ¤– AI Ã–zet: ${summaryText}</div>
                        <button class="translate-btn" onclick="document.getElementById('translate-menu').classList.toggle('open')">ğŸŒ Ã‡evir</button>
                        <div id="translate-menu" class="snooze-menu">
                            <div class="snooze-option" onclick="translateEmail('en')">ğŸ‡¬ğŸ‡§ English</div>
                            <div class="snooze-option" onclick="translateEmail('de')">ğŸ‡©ğŸ‡ª Deutsch</div>
                            <div class="snooze-option" onclick="translateEmail('fr')">ğŸ‡«ğŸ‡· FranÃ§ais</div>
                            <div class="snooze-option" onclick="translateEmail('es')">ğŸ‡ªğŸ‡¸ EspaÃ±ol</div>
                            <div class="snooze-option" onclick="translateEmail('ar')">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</div>
                        </div>
                    </div>
                </div>
                ${msg.isNewsletter ? `
                    <div class="unsubscribe-banner">
                        <span>ğŸ“° Bu bir newsletter e-postasÄ±</span>
                        <button class="unsubscribe-btn" onclick="smartUnsubscribe('${msg.email}')">ğŸš« AboneliÄŸi Ä°ptal Et</button>
                    </div>
                ` : ''}
                <div class="preview-body" style="padding:24px; line-height:1.7; color:var(--text-secondary);">
                    ${msg.body}
                </div>
                ${msg.attachments ? `
                    <div class="attachments-bar">
                        ${msg.attachments.map(a => `<a class="attachment-chip" href="#" onclick="downloadAttachment('${a}')">ğŸ“ ${a}</a>`).join('')}
                    </div>
                ` : ''}
                <div class="quick-replies">
                    <button class="quick-reply-btn" onclick="quickReply('TeÅŸekkÃ¼rler')">ğŸ‘ TeÅŸekkÃ¼rler</button>
                    <button class="quick-reply-btn" onclick="quickReply('AnladÄ±m')">âœ… AnladÄ±m</button>
                    <button class="quick-reply-btn" onclick="quickReply('Ä°nceleyeceÄŸim')">ğŸ“‹ Ä°nceleyeceÄŸim</button>
                    <button class="quick-reply-btn" onclick="quickReply('ToplantÄ± ayarlayalÄ±m')">ğŸ“… ToplantÄ±</button>
                </div>
            `;
        }

        // ===== EVENT HANDLERS =====
        function selectAccount(id) {
            currentAccount = id;
            renderAccounts();
            renderFolders();
            renderMessages();
            closeMobileMenu();
        }

        function selectFolder(id) {
            currentFolder = id;
            selectedMessage = null;
            renderFolders();
            renderMessages();
            $('preview').innerHTML = '<div class="empty-state"><div class="empty-icon">ğŸ“¬</div><div class="empty-text">Bir e-posta seÃ§in</div></div>';
            closeMobileMenu();
        }

        function selectMessage(id) {
            selectedMessage = id;
            const msg = messages.find(m => m.id === id);
            if (msg) {
                msg.unread = false;
                renderMessages();
                renderPreview(msg);
                renderFolders();
            }
        }

        function searchMessages() {
            renderMessages();
        }

        function syncMessages() {
            showToast('âœ“ Senkronizasyon tamamlandÄ±');
            renderMessages();
        }

        function refreshMessages() {
            renderMessages();
        }

        function toggleUnified() {
            renderMessages();
        }

        // ===== COMPOSE =====
        function openCompose() {
            $('compose-modal').style.display = 'flex';
            $('compose-to').focus();
            closeMobileMenu();
        }

        function closeCompose() {
            $('compose-modal').style.display = 'none';
            $('compose-to').value = '';
            $('compose-subject').value = '';
            $('compose-body').value = '';
        }

        function sendEmail() {
            sendEmailWithUndo();
        }

        // ===== MESSAGE ACTIONS =====
        function replyMessage(id) {
            const msg = messages.find(m => m.id === id);
            if (msg) {
                openCompose();
                $('compose-to').value = msg.email;
                $('compose-subject').value = 'Re: ' + msg.subject;
            }
        }

        function forwardMessage(id) {
            const msg = messages.find(m => m.id === id);
            if (msg) {
                openCompose();
                $('compose-subject').value = 'Fwd: ' + msg.subject;
            }
        }

        function deleteMessage(id) {
            if (confirm('Bu e-postayÄ± silmek istediÄŸinize emin misiniz?')) {
                const idx = messages.findIndex(m => m.id === id);
                if (idx !== -1) {
                    messages[idx].folder = 'trash';
                    selectedMessage = null;
                    renderMessages();
                    renderFolders();
                    $('preview').innerHTML = '<div class="empty-state"><div class="empty-icon">ğŸ—‘ï¸</div><div class="empty-text">Mesaj silindi</div></div>';
                    showToast('âœ“ Mesaj Ã§Ã¶p kutusuna taÅŸÄ±ndÄ±');
                }
            }
        }

        function downloadAttachment(name) {
            showToast('ğŸ“¥ ' + name + ' indiriliyor...');
        }

        // ===== THEME =====
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? null : 'light';

            if (newTheme) {
                html.setAttribute('data-theme', 'light');
                localStorage.setItem('mailora-theme', 'light');
                updateThemeButtons('â˜€ï¸');
            } else {
                html.removeAttribute('data-theme');
                localStorage.setItem('mailora-theme', 'dark');
                updateThemeButtons('ğŸŒ™');
            }
        }

        function updateThemeButtons(icon) {
            $('theme-btn').textContent = icon;
            const mobileBtn = $('theme-btn-mobile');
            if (mobileBtn) mobileBtn.textContent = icon;
        }

        // ===== MOBILE MENU =====
        function toggleMobileMenu() {
            const sidebar = $('sidebar');
            const overlay = $('sidebar-overlay');
            sidebar.classList.toggle('open');
            overlay.classList.toggle('open');
        }

        function closeMobileMenu() {
            const sidebar = $('sidebar');
            const overlay = $('sidebar-overlay');
            sidebar.classList.remove('open');
            overlay.classList.remove('open');
        }

        // ===== KEYBOARD SHORTCUTS =====
        document.addEventListener('keydown', (e) => {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;

            const currentIdx = filteredMessages.findIndex(m => m.id === selectedMessage);

            if (e.key === 'j' && currentIdx < filteredMessages.length - 1) {
                selectMessage(filteredMessages[currentIdx + 1].id);
            } else if (e.key === 'k' && currentIdx > 0) {
                selectMessage(filteredMessages[currentIdx - 1].id);
            } else if (e.key === 'c') {
                openCompose();
            } else if (e.key === '/' || e.key === 'f') {
                e.preventDefault();
                $('search-input').focus();
            } else if (e.key === 'Escape') {
                closeCompose();
                closeMobileMenu();
            }
        });

        // ===== NEW FEATURES =====

        // Pin/Unpin
        function togglePin(id, e) {
            e?.stopPropagation();
            const msg = messages.find(m => m.id === id);
            if (msg) {
                msg.pinned = !msg.pinned;
                msg.important = msg.pinned;
                renderMessages();
                showToast(msg.pinned ? 'ğŸ“Œ Sabitlendi' : 'ğŸ“Œ Sabitleme kaldÄ±rÄ±ldÄ±');
            }
        }

        // Snooze
        function snoozeMessage(id, duration, e) {
            e?.stopPropagation();
            showToast(`â° ${duration} sonra hatÄ±rlatÄ±lacak`);
        }

        // Focus Mode
        function toggleFocusMode() {
            const checked = $('focus-check')?.checked;
            $('message-list')?.classList.toggle('focus-mode', checked);
            showToast(checked ? 'ğŸ¯ Odak Modu: AÃ§Ä±k' : 'ğŸ¯ Odak Modu: KapalÄ±');
        }

        // Analytics
        function toggleAnalytics() {
            $('analytics-drawer')?.classList.toggle('open');
        }

        // Contact Insights
        function openContactInsights(msg, e) {
            e?.stopPropagation();
            const color = getAvatarColor(msg.from);
            $('contact-avatar').textContent = getInitials(msg.from);
            $('contact-avatar').style.background = color;
            $('contact-name').textContent = msg.from;
            $('contact-email').textContent = msg.email;
            $('contact-drawer')?.classList.add('open');
        }

        function closeContactDrawer() {
            $('contact-drawer')?.classList.remove('open');
        }

        function showAttachmentGallery() {
            showToast('ğŸ“ TÃ¼m ekler gÃ¶steriliyor...');
            closeContactDrawer();
        }

        // Translate
        function translateEmail(lang) {
            const translations = {
                'en': 'This email has been translated to English.',
                'de': 'Diese E-Mail wurde ins Deutsche Ã¼bersetzt.',
                'fr': 'Cet email a Ã©tÃ© traduit en franÃ§ais.',
                'es': 'Este correo ha sido traducido al espaÃ±ol.',
                'ar': 'ØªÙ…Øª ØªØ±Ø¬Ù…Ø© Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©.'
            };
            showToast(`ğŸŒ ${lang.toUpperCase()}'e Ã§evrildi`);
        }

        // Quick Reply
        function quickReply(text) {
            showToast(`âœ“ YanÄ±t gÃ¶nderildi: "${text}"`);
        }

        // Smart Unsubscribe
        function smartUnsubscribe(email) {
            showToast(`ğŸš« ${email} aboneliÄŸi iptal edildi`);
        }

        // Reading Time Calculator
        function getReadingTime(body) {
            const words = body?.replace(/<[^>]*>/g, '').split(/\s+/).length || 0;
            const mins = Math.ceil(words / 200);
            return mins < 1 ? '<1' : mins;
        }

        // Undo Send with timer
        let undoTimeout = null;
        function sendEmailWithUndo() {
            const to = $('compose-to').value;
            const subject = $('compose-subject').value;
            const scheduled = $('schedule-check')?.checked;
            const scheduleTime = $('schedule-time')?.value;

            if (!to || !subject) {
                alert('Kime ve Konu alanlarÄ± zorunludur!');
                return;
            }

            closeCompose();

            if (scheduled && scheduleTime) {
                showToast(`ğŸ“… E-posta ${new Date(scheduleTime).toLocaleString('tr-TR')} iÃ§in zamanlandÄ±`);
                return;
            }

            const toast = document.createElement('div');
            toast.className = 'toast undo';
            toast.innerHTML = `GÃ¶nderiliyor... <button class="undo-btn" onclick="cancelSend(this)">Ä°ptal</button>`;
            document.body.appendChild(toast);

            undoTimeout = setTimeout(() => {
                toast.remove();
                showToast('âœ“ E-posta gÃ¶nderildi!');
            }, 5000);
        }

        function cancelSend(btn) {
            clearTimeout(undoTimeout);
            btn.parentElement.remove();
            showToast('â†©ï¸ GÃ¶nderim iptal edildi');
            openCompose();
        }

        // Schedule checkbox toggle
        $('schedule-check')?.addEventListener('change', function () {
            $('schedule-time').style.display = this.checked ? 'block' : 'none';
        });

        // ===== INIT =====
        (function init() {
            // Load saved theme
            const savedTheme = localStorage.getItem('mailora-theme');
            if (savedTheme === 'light') {
                document.documentElement.setAttribute('data-theme', 'light');
                setTimeout(() => updateThemeButtons('â˜€ï¸'), 0);
            }

            // Add pinned and important flags to some messages
            messages[0].pinned = true;
            messages[0].important = true;
            messages[2].important = true;
            messages[4].isNewsletter = true;

            // Render initial state
            renderAccounts();
            renderFolders();
            renderMessages();

            // Schedule checkbox handler
            const scheduleCheck = $('schedule-check');
            if (scheduleCheck) {
                scheduleCheck.addEventListener('change', function () {
                    $('schedule-time').style.display = this.checked ? 'block' : 'none';
                });
            }

            // Initialize Drag & Drop
            initDragDrop();
        })();

        // ===== FILE ATTACHMENT FUNCTIONS =====
        let attachedFiles = [];
        const MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB

        function initDragDrop() {
            const dropzone = $('dropzone');
            if (!dropzone) return;

            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropzone.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                dropzone.addEventListener(eventName, () => dropzone.classList.add('dragover'), false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                dropzone.addEventListener(eventName, () => dropzone.classList.remove('dragover'), false);
            });

            dropzone.addEventListener('drop', handleDrop, false);
        }

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles(files);
        }

        function handleFileSelect(e) {
            const files = e.target.files;
            handleFiles(files);
        }

        function handleFiles(files) {
            [...files].forEach(file => {
                if (file.size > MAX_FILE_SIZE) {
                    showAttachmentError(`${file.name} Ã§ok bÃ¼yÃ¼k (maks. 10MB)`);
                    return;
                }

                if (attachedFiles.some(f => f.name === file.name && f.size === file.size)) {
                    showAttachmentError(`${file.name} zaten ekli`);
                    return;
                }

                attachedFiles.push(file);
                renderAttachmentPreview(file);
            });

            // Clear the input for re-selection
            $('compose-files').value = '';
        }

        function renderAttachmentPreview(file) {
            const previewContainer = $('attachment-preview');
            const isImage = file.type.startsWith('image/');
            const fileId = `file-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;

            const item = document.createElement('div');
            item.className = `attachment-item ${isImage ? 'image' : ''}`;
            item.id = fileId;
            item.dataset.fileName = file.name;

            if (isImage) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    item.innerHTML = `
                        <img src="${e.target.result}" class="preview-img" alt="${file.name}">
                        <div class="file-info">
                            <span class="file-name">${file.name}</span>
                            <span class="file-size">${formatFileSize(file.size)}</span>
                        </div>
                        <button class="remove-btn" onclick="removeAttachment('${fileId}', '${file.name}')">âœ•</button>
                    `;
                };
                reader.readAsDataURL(file);
            } else {
                item.innerHTML = `
                    <span class="file-icon">${getFileIcon(file.type)}</span>
                    <div class="file-info">
                        <span class="file-name">${file.name}</span>
                        <span class="file-size">${formatFileSize(file.size)}</span>
                    </div>
                    <button class="remove-btn" onclick="removeAttachment('${fileId}', '${file.name}')">âœ•</button>
                `;
            }

            previewContainer.appendChild(item);
        }

        function removeAttachment(fileId, fileName) {
            const item = document.getElementById(fileId);
            if (item) {
                item.style.animation = 'slideIn 0.2s ease-out reverse';
                setTimeout(() => item.remove(), 200);
            }
            attachedFiles = attachedFiles.filter(f => f.name !== fileName);
        }

        function clearAttachments() {
            attachedFiles = [];
            const previewContainer = $('attachment-preview');
            if (previewContainer) previewContainer.innerHTML = '';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        function getFileIcon(mimeType) {
            if (mimeType.startsWith('image/')) return 'ğŸ–¼ï¸';
            if (mimeType.includes('pdf')) return 'ğŸ“„';
            if (mimeType.includes('word') || mimeType.includes('document')) return 'ğŸ“';
            if (mimeType.includes('excel') || mimeType.includes('spreadsheet')) return 'ğŸ“Š';
            if (mimeType.includes('powerpoint') || mimeType.includes('presentation')) return 'ğŸ“½ï¸';
            if (mimeType.includes('zip') || mimeType.includes('rar') || mimeType.includes('archive')) return 'ğŸ“¦';
            if (mimeType.includes('audio')) return 'ğŸµ';
            if (mimeType.includes('video')) return 'ğŸ¬';
            return 'ğŸ“';
        }

        function showAttachmentError(message) {
            const section = $('attachment-section');
            const existingError = section.querySelector('.attachment-error');
            if (existingError) existingError.remove();

            const error = document.createElement('div');
            error.className = 'attachment-error';
            error.innerHTML = `âš ï¸ ${message}`;
            section.appendChild(error);

            setTimeout(() => error.remove(), 3000);
        }

        function getAttachedFiles() {
            return attachedFiles;
        }
    </script>
</body>

</html>